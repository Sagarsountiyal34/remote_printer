<!-- From History Modal -->
<div class="modal" id="fromHistory" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document" style="max-width:1000px;">
        <div class="modal-content" id="fromHistoryModalContent">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Upload Document into group</h5>
                <button type="button" class="close" data-dismiss="modal" id="close_history_modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="card mb-3">
                    <div class="card-header">
                        <i class="fas fa-table"></i>
                        All Documents</div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-bordered document_table" id="dataTableFromHistory" width="100%" cellspacing="0">
                                <thead>
                                    <tr>
                                        <th width="10%">Select</th>
                                        <th width="45%">Preview</th>
                                        <th width="45%">Name</th>
                                    </tr>
                                </thead>
                                <tbody id="history_tbody_head">
                                    <% @all_documents.each do |a| %>
                                    <tr data-id="<%= a.id%>" class="document_record_for_add">
                                        <td width="10%">
                                            <%= check_box_tag a.id, '', false, class: 'document_check_box'%>
                                        </td>
                                        <td width="30%">
                                            <div class="item gallery_item" data-iframe="<%= have_to_show_iframe(a) %>" data-src="<%= a.get_preview_url %>">
                                                <a href="javscript:;"><i class="fas fa-eye"></i></a>
                                            </div>
                                        </td>
                                        <td width="45%">
                                            <%= a.document_name %>
                                        </td>
                                    </tr>
                                    <% end %>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card-footer small text-muted">
                        <%= button_tag "Add for printing", id: 'add_to_group', class: 'btn btn-primary', :data => {id: @group.id.to_s} %>
                    </div>
                    <div id="loader_wrap" class="loader_wrap_from_history">
                        <img src="/images/loader.gif" id="loader_img" width="100" height="100">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
var fromHistoryModal = $('#dataTableFromHistory').DataTable({
    "pageLength": 3,
    "ordering": false,
    "stateSave": true
});


$('#history_tbody_head').lightGallery({
    selector: '.gallery_item',
    iframeMaxWidth: '80%',
    thumbnail: false,
});

// for multiple using checkboxes
$("#add_to_group").on('click', function() {
    jQuery('.loader_wrap_from_history').show();
    jQuery('#add_to_group').hide();
    var allPages = fromHistoryModal.cells().nodes();
    var checked_checkboxes = $('.document_check_box:checked', allPages);
    var document_ids = checked_checkboxes.map(function() {
        return $(this).attr('id');
    }).get();
    var group_id = jQuery(this).data('id');

    function onSuccess(response) {
        $('#fromHistory').modal('hide');
        $('#group_content').html(response);
    }
    addToGroup(group_id, document_ids, onSuccess);
});


function addToGroup(group_id, document_ids, successcb, errorcb) {
    $.ajax({
        type: "POST",
        beforeSend: setCsrfToken, // implemented in
        url: "/add_document_to_group",
        data: { document_ids: document_ids, id: group_id },
        success: function(data) {
            if (successcb) successcb(data);
        },
        error: function(exception) {
            if (successcb) successcb(exception);
        }
    });
}
</script>